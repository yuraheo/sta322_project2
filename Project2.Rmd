```{r}
# Define factor levels
rotor_length <- c("7.5 cm", "8.5 cm")
leg_length   <- c("7.5 cm", "12.0 cm")
leg_width    <- c("3.2 cm", "5.0 cm")
paper_clip   <- c("No", "Yes")

# Create full 2^4 factorial design
base_design <- expand.grid(
  RotorLength = rotor_length,
  LegLength   = leg_length,
  LegWidth    = leg_width,
  PaperClip   = paper_clip
)

# Add 4 replicates per combination
design <- base_design[rep(1:nrow(base_design), each = 4), ]

# Add replicate number
design$Replicate <- rep(1:4, times = nrow(base_design))

# Add empty column for flight time
design$FlightTime_sec <- NA

# Save CSV
#write.csv(design, "helicopter_design.csv", row.names = FALSE)

#design

```
```{r}
library(tidyverse)
library(emmeans)
heli <- read_csv("helicopter_design.csv")

glimpse(heli)
heli <- heli %>%
  mutate(
    rotor    = factor(RotorLength),
    leg_len  = factor(LegLength),
    leg_width= factor(LegWidth),
    clip     = factor(PaperClip)
  )

# fit full factorial
fit_full <- aov(FlightTime_sec ~ rotor * leg_len * leg_width * clip, data = heli)

summary(fit_full)  # anova table for main effects + all interactions

```

# Q1. Which factors are most important to make helicopters that fly longer?

```{r}
fit_main <- lm(
  FlightTime_sec ~ rotor + leg_len + leg_width + clip,
  data = heli
)

summary(fit_main)
confint(fit_main)
```
The model results indicate that leg length and paperclip use are the most important factors influencing helicopter flight duration. The effect of increasing leg length (from 7.5cm to 12.0cm) is estimated to decrease flight time by 0.26 seconds (SE = 0.0587). With the 95% confidence interval being entirely below zero, this shows strong evidence that longer legs reduce flight time, making shorter legs the better design. 
```{r}
fit_full <- lm(
  FlightTime_sec ~ rotor * leg_len * leg_width * clip,
  data = heli
)
summary(fit_full)
```

## Esimate mean and 95% CI
```{r}
emmeans(fit_main2, specs = "rotor")       # means & CI for rotor length
emmeans(fit_main2, specs = "leg_len")     # means & CI for leg length
emmeans(fit_main2, specs = "leg_width")   # means & CI for leg width
emmeans(fit_main2, specs = "clip")        # means & CI for paperclip

# High vs low *effects* (difference + 95% CI) for each factor
contrast(emmeans(fit_main2, "rotor"),     method = "revpairwise")  # high - low
contrast(emmeans(fit_main2, "leg_len"),   method = "revpairwise")
contrast(emmeans(fit_main2, "leg_width"), method = "revpairwise")
contrast(emmeans(fit_main2, "clip"),      method = "revpairwise")
```


# Q2. Is there any evidence that the effect of rotor length differs by leg width?
```{r}
# test rotor:leg_width interaction
summary(fit_main2)
# rotor effect within each leg width level 
emm_rw <- emmeans(fit_main2, ~ rotor | leg_width)
emm_rw
contrast(emm_rw, "revpairwise")  # rotor_high - rotor_low at each leg_width
# If the differences (and/or interaction p-value) are large and significant,
# that’s evidence that rotor effect depends on leg width.
```



# Q3: What would you recommend as the ideal combination to make the helicopter fly long?
```{r}
# Use model to predict mean flight time for *every* combination
combos <- expand.grid(
  rotor     = levels(heli$rotor),
  leg_len   = levels(heli$leg_len),
  leg_width = levels(heli$leg_width),
  clip      = levels(heli$clip)
)

combos$pred_flight <- predict(fit_main2, newdata = combos)

# Sort from longest to shortest predicted flight time
best_combos <- combos %>% arrange(desc(pred_flight))

best_combos    # first row = recommended (“ideal”) combination

```

# Diagnostics
```{r}
par(mfrow = c(1, 2))
plot(fit_main2, which = 1)  # Residuals vs fitted (check linearity + constant variance)
plot(fit_main2, which = 2)  # Normal Q–Q plot of residuals

par(mfrow = c(1, 1))
```

